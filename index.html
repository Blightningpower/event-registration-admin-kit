<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#4b0082" />

    <title>Event Registration</title>

    <!-- Favicons (update paths if needed) -->
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/branding/favicon_io/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="../assets/branding/favicon_io/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="../assets/branding/favicon_io/favicon-16x16.png" />
    <link rel="icon" href="../assets/branding/favicon_io/favicon.ico" />

    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body>
    <header>
      <h1>Event Registration</h1>
    </header>

    <main>
      <ul>
        <li>
          <p>
            Welcome! Please complete the registration form below.
            After submitting, you will be redirected to the payment page to finalize your registration.
          </p>
        </li>

        <li>
          <p><span>No payment = no registration.</span></p>
        </li>

        <li>
          <p>Fields marked with <span class="requiredField">*</span> are required.</p>
        </li>

        <li>
          <p><strong>Note:</strong> This form is per participant. Register multiple participants by submitting the form multiple times.</p>
        </li>
      </ul>

      <!-- IMPORTANT: action points to your PHP handler -->
      <form id="registrationForm" action="submit_registration.php" method="POST" novalidate>
        <!-- Group / Grade -->
        <div class="row">
          <div class="col-25">
            <label for="group"><span class="requiredField">*</span>Group/Grade</label>
          </div>
          <div class="col-75">
            <select id="group" name="group" required>
              <option value="">-- Select --</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="other">Other</option>
            </select>

            <input
              type="text"
              id="customGroup"
              name="custom_group"
              class="conditional-input"
              placeholder="Enter group/grade"
              inputmode="numeric"
            />

            <div class="error-msg" id="err-group">Group/grade is required.</div>
          </div>
        </div>

        <!-- Participant -->
        <h2 style="margin-top: 18px;">Participant</h2>

        <div class="row">
          <div class="col-25">
            <label for="participantFirstName"><span class="requiredField">*</span>First name</label>
          </div>
          <div class="col-75">
            <input
              type="text"
              id="participantFirstName"
              name="participant_first_name"
              placeholder="First name"
              required
              autocomplete="given-name"
            />
            <div class="error-msg" id="err-participantFirstName">First name is required.</div>
          </div>
        </div>

        <div class="row">
          <div class="col-25">
            <label for="participantMiddleName">Middle name (optional)</label>
          </div>
          <div class="col-75">
            <input
              type="text"
              id="participantMiddleName"
              name="participant_middle_name"
              placeholder="e.g., van, de, den"
              autocomplete="additional-name"
            />
            <div class="error-msg" id="err-participantMiddleName">Only letters/spaces are allowed.</div>
          </div>
        </div>

        <div class="row">
          <div class="col-25">
            <label for="participantLastName"><span class="requiredField">*</span>Last name</label>
          </div>
          <div class="col-75">
            <input
              type="text"
              id="participantLastName"
              name="participant_last_name"
              placeholder="Last name"
              required
              autocomplete="family-name"
            />
            <div class="error-msg" id="err-participantLastName">Last name is required.</div>
          </div>
        </div>

        <div class="row">
          <div class="col-25">
            <label for="participantPhone"><span class="requiredField">*</span>Phone number</label>
          </div>
          <div class="col-75">
            <input
              type="text"
              id="participantPhone"
              name="participant_phone"
              placeholder="Phone number"
              required
              inputmode="tel"
              autocomplete="tel"
            />
            <div class="error-msg" id="err-participantPhone">Enter a valid phone number (min. 10 digits).</div>
          </div>
        </div>

        <div class="row">
          <div class="col-25">
            <label for="participantEmail"><span class="requiredField">*</span>Email</label>
          </div>
          <div class="col-75">
            <input
              type="email"
              id="participantEmail"
              name="participant_email"
              placeholder="Email address"
              required
              autocomplete="email"
            />
            <div class="error-msg" id="err-participantEmail">Enter a valid email address.</div>
          </div>
        </div>

        <!-- Parent/Guardian -->
        <h2 style="margin-top: 18px;">Parent / Guardian</h2>

        <div class="row">
          <div class="col-25">
            <label for="guardianFirstName"><span class="requiredField">*</span>First name</label>
          </div>
          <div class="col-75">
            <input
              type="text"
              id="guardianFirstName"
              name="guardian_first_name"
              placeholder="First name"
              required
              autocomplete="given-name"
            />
            <div class="error-msg" id="err-guardianFirstName">First name is required.</div>
          </div>
        </div>

        <div class="row">
          <div class="col-25">
            <label for="guardianMiddleName">Middle name (optional)</label>
          </div>
          <div class="col-75">
            <input
              type="text"
              id="guardianMiddleName"
              name="guardian_middle_name"
              placeholder="e.g., van, de, den"
              autocomplete="additional-name"
            />
            <div class="error-msg" id="err-guardianMiddleName">Only letters/spaces are allowed.</div>
          </div>
        </div>

        <div class="row">
          <div class="col-25">
            <label for="guardianLastName"><span class="requiredField">*</span>Last name</label>
          </div>
          <div class="col-75">
            <input
              type="text"
              id="guardianLastName"
              name="guardian_last_name"
              placeholder="Last name"
              required
              autocomplete="family-name"
            />
            <div class="error-msg" id="err-guardianLastName">Last name is required.</div>
          </div>
        </div>

        <div class="row">
          <div class="col-25">
            <label for="guardianPhone">Phone number (optional)</label>
          </div>
          <div class="col-75">
            <input
              type="text"
              id="guardianPhone"
              name="guardian_phone"
              placeholder="Phone number"
              inputmode="tel"
              autocomplete="tel"
            />
            <div class="error-msg" id="err-guardianPhone">Enter a valid phone number (min. 10 digits).</div>
          </div>
        </div>

        <div class="row">
          <div class="col-25">
            <label for="guardianEmail"><span class="requiredField">*</span>Email</label>
          </div>
          <div class="col-75">
            <input
              type="email"
              id="guardianEmail"
              name="guardian_email"
              placeholder="Email address"
              required
              autocomplete="email"
            />
            <div class="error-msg" id="err-guardianEmail">Enter a valid email address.</div>
          </div>
        </div>

        <!-- Payment / IBAN -->
        <h2 style="margin-top: 18px;">Payment</h2>

        <div class="row">
          <div class="col-25">
            <label for="iban"><span class="requiredField">*</span>IBAN</label>
          </div>
          <div class="col-75">
            <input
              type="text"
              id="iban"
              name="iban"
              placeholder="IBAN used for the payment"
              required
              autocomplete="off"
            />
            <div class="error-msg" id="err-iban">IBAN is required.</div>
          </div>
        </div>

        <button id="submitButton" type="submit">Submit</button>

        <p class="muted" id="formErrorSummary" style="display:none; margin-top: 12px;">
          Please correct the highlighted fields.
        </p>
      </form>
    </main>

    <script>
      // ---------- Utilities ----------
      const $ = (id) => document.getElementById(id);

      function showError(field, messageEl, show) {
        if (!field || !messageEl) return;
        if (show) {
          field.classList.add('invalid');
          messageEl.style.display = 'block';
        } else {
          field.classList.remove('invalid');
          messageEl.style.display = 'none';
        }
      }

      // ---------- Conditional group field ----------
      const groupSelect = $('group');
      const customGroupInput = $('customGroup');

      function toggleCustomGroup() {
        const isOther = groupSelect.value === 'anders';
        customGroupInput.classList.toggle('show', isOther);
        customGroupInput.style.display = isOther ? 'block' : 'none';
        customGroupInput.required = isOther;
        if (!isOther) customGroupInput.value = '';
      }
      toggleCustomGroup();
      groupSelect.addEventListener('change', toggleCustomGroup);

      // ---------- Validators ----------
      const nameRegex = /^[a-zàáâäãåæçèéêëìíîïðñòóôõöøùúûüýþÿ\s'-]{2,}$/i;
      const middleRegex = /^[a-zàáâäãåæçèéêëìíîïðñòóôõöøùúûüýþÿ\s'-]{0,}$/i;

      function isValidName(v) { return nameRegex.test(v.trim()); }
      function isValidMiddle(v) { return v.trim() === '' || middleRegex.test(v.trim()); }
      function isValidEmail(v) { return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v.trim()); }

      function digitsCount(v) { return v.replace(/[^\d]/g, '').length; }
      function isValidPhoneRequired(v) { return digitsCount(v) >= 10; }
      function isValidPhoneOptional(v) { return v.trim() === '' || digitsCount(v) >= 10; }

      function isValidIban(v) {
        return v.trim().length >= 10; // keep it light; server handles stronger checks if desired
      }

      // ---------- Field config ----------
      const fields = [
        { id: 'group', err: 'err-group', validate: () => groupSelect.value !== '' && (groupSelect.value !== 'anders' || customGroupInput.value.trim() !== '') },

        { id: 'participantFirstName', err: 'err-participantFirstName', validate: (v) => isValidName(v) },
        { id: 'participantMiddleName', err: 'err-participantMiddleName', validate: (v) => isValidMiddle(v) },
        { id: 'participantLastName', err: 'err-participantLastName', validate: (v) => isValidName(v) },
        { id: 'participantPhone', err: 'err-participantPhone', validate: (v) => isValidPhoneRequired(v) },
        { id: 'participantEmail', err: 'err-participantEmail', validate: (v) => isValidEmail(v) },

        { id: 'guardianFirstName', err: 'err-guardianFirstName', validate: (v) => isValidName(v) },
        { id: 'guardianMiddleName', err: 'err-guardianMiddleName', validate: (v) => isValidMiddle(v) },
        { id: 'guardianLastName', err: 'err-guardianLastName', validate: (v) => isValidName(v) },
        { id: 'guardianPhone', err: 'err-guardianPhone', validate: (v) => isValidPhoneOptional(v) },
        { id: 'guardianEmail', err: 'err-guardianEmail', validate: (v) => isValidEmail(v) },

        { id: 'iban', err: 'err-iban', validate: (v) => isValidIban(v) },
      ];

      // Validate on blur
      fields.forEach(({ id, err, validate }) => {
        const field = $(id);
        const errEl = $(err);
        if (!field) return;

        field.addEventListener('blur', () => {
          const ok = validate(field.value);
          showError(field, errEl, !ok);
        });
      });

      // Submit validation
      $('registrationForm').addEventListener('submit', (e) => {
        let ok = true;

        fields.forEach(({ id, err, validate }) => {
          const field = $(id);
          const errEl = $(err);
          if (!field) return;

          const valid = validate(field.value);
          showError(field, errEl, !valid);
          if (!valid) ok = false;
        });

        const summary = $('formErrorSummary');
        if (!ok) {
          e.preventDefault();
          summary.style.display = 'block';
          // scroll to first invalid field
          const firstInvalid = document.querySelector('.invalid');
          if (firstInvalid) firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
          summary.style.display = 'none';
        }
      });
    </script>
  </body>
</html>